<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>WebSockets and Server-Sent Events</title>

		<meta name="description" content="WebSockets and Server-Sent Events: what for? How?">
		<meta name="author" content="Cédric Tran-Xuan">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/streamdataio.css" id="theme">
		<link rel="stylesheet" href="css/bootstrap.min.css">
		<link rel="stylesheet" href="css/bootstrap-theme.min.css">
		<!-- <link rel="stylesheet" href="css/flexboxgrid.css"> -->

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>
		<div class="reveal">
			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section class="cover" data-state="cover">
					<p>
						<img width="153" height="86" alt="Streamdata.io logo" src="img/streamdataio-with-text-vl.png" />
						<img width="153" height="86" alt="Human Talks" src="img/humanTalks-430x258.png" style="margin-left: 20px" />
					</p>
					<p>
						<img alt="WebSockets &amp; Server-Sent Events" src="img/websockets-sse-cover.png" width="30%"/>
					</p>
					<h4>Pourquoi ? Comment ?</h4>
					<div class="avatar-twitter-container">
						<div class="avatar-item"><img alt="ctranxuan-avatar" src="img/ctx-avatar.png" /></div>
						<a target="_blank" href="https://twitter.com/ctranxuan" class="avatar-item">@ctranxuan</a>
					</div>
				</section>
				<section>
					<div class="row">
						<div class="col-md-6">
							<h2>WebSockets</h2>
							<ul>
								<li>Push techno</li>
								<li>W3C</li>
								<li>2008</li>
							</ul>
						</div>
						<div class="col-md-6">
							<h2>Server-Sent Events</h2>
							<ul>
								<li>Push techno</li>
								<li>W3C</li>
								<li>2006</li>
							</ul>
						</div>
					</div>
				</section>
				<section>
					<div class="row">
						<div class="col-md-6">
							<h2>WebSockets</h2>
							<p><img alt="bi-directional / full-duplex protocol" src="img/bidirectional.gif"></p>
						</div>
						<div class="col-md-6">
							<h2>Server-Sent Events</h2>
							<p><img alt="Server push to client protocol" src="img/unidirectional.gif" class="fragment"></p>
						</div>
					</div>
				</section>
				<section>
					<div class="row">
						<div class="col-md-6">
							<h2>WebSockets</h2>
							<ul>
								<li>TCP</li>
								<li>low-level protocol</li>
								<li>HTTP upgrade handshake</li>
							</ul>
							<pre>
								<code data-trim>
GET /chat HTTP/1.1
Host: example.com:8000
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
Sec-WebSocket-Version: 13
								</code>
							</pre>
						</div>
						<div class="col-md-6">
							<h2>Server-Sent Events</h2>
							<img alt="HTTP/1.1, what else?" src="img/http-what-else.jpg" class="fragment"/>
							<pre class="fragment">
								<code data-trim class="hljs http">
GET /stream HTTP/1.1 1
Host: example.com
Accept: text/event-stream
								</code>
							</pre>
						</div>
					</div>
				</section>
				<section>
					<div class="row">
						<div class="col-md-6">
							<h2>WebSockets</h2>
							<p>proxies and load balancers
							reconfiguration</p>
							<p><img alt="proxies reconfiguration" src="img/reconfig-proxy2.jpg" width="70%" class="fragment"/></p>
							<p><img alt="be kind with the ops for the reconfiguration" src="img/cat-reconfig.jpg" width="30%" class="fragment"/></p>
						</div>
						<div class="col-md-6">
							<h2>Server-Sent Events</h2>
							<br/>
							<p class="fragment">No need to reconfigure! <br>(it's HTTP)</p>
						</div>
					</div>
				</section>
				<section>
					<div class="row">
						<div class="col-md-6">
							<h2>WebSockets</h2>
							<img alt="no reconnection mechanism" src="img/deconnection2.jpg"/>
						</div>
						<div class="col-md-6">
							<h2>Server-Sent Events</h2>
							<p>
								<img alt="reconnection mechanism + retry" src="img/reconnection.jpg"/>
							</p>
						</div>
					</div>
				</section>
				<section>
					<section>
						<div class="row">
							<div class="col-md-6">
								<h2>WebSockets</h2>
								<p>binary + text</p>
								<p class="fragment" data-fragment-index="1">native support browsers</p>
							</div>
							<div class="col-md-6">
								<h2>Server-Sent Events</h2>
								<p>text</p>
								<table class="fragment" data-fragment-index="2">
									<thead>
										<tr>
											<th>API</th>
											<th><img alt="Chrome" src="img/chrome-icon.png"/></th>
											<th><img alt="Firefox" src="img/firefox-icon.png"/></th>
											<th><img alt="IE" src="img/edge-icon.png"/></th>
											<th><img alt="Safari" src="img/safari-icon.png"/></th>
											<th><img alt="Opera" src="img/opera-icon.png"/></th>
										</tr>
									</thead>
									<tbody>
										<tr>
											<td class="no-bottom-line">SSE</td>
											<td class="no-bottom-line">6.0</td>
											<td class="no-bottom-line">6.0</td>
											<td class="no-bottom-line"><span class="failure">not</span><br/><span class="failure">supported</span></td>
											<td class="no-bottom-line">5.0</td>
											<td class="no-bottom-line">11.5</td>
										</tr>
										<tr class="fragment" data-fragment-index="3">
											<td class="no-bottom-line"></td>
											<td class="no-bottom-line"></td>
											<td class="no-bottom-line"></td>
											<td class="no-bottom-line">
												<img alt="not supported" src="img/red-arrow.png"/>
											</td>
											<td class="no-bottom-line"></td>
										</tr>
										<tr class="fragment" data-fragment-index="3" valign="middle">
											<td class="no-bottom-line" colspan="5">
												<img alt="not supported" src="img/shocked.gif" width="70%"/>
											</td>
										</tr>
									</tbody>
								</table>
								<p class="fragment" data-fragment-index="4">… but polyfills</p>
							</div>
						</div>
					</section>
					<section>
						<p>
							<div>
								<a target="_blank" href="https://goo.gl/cCMIGf">https://goo.gl/cCMIGf</a>
								<img alt="Edge needs you: vote for SSE support!" src="img/edge-needs-you3.jpg" width="30%"/>
								<a target="_blank" href="https://goo.gl/HjJDIv">https://goo.gl/HjJDIv</a>
							</div>
							<div>
								<a target="_blank" href="https://goo.gl/cCMIGf"><img alt="Vote for SSE support in Edge" src="img/edge-vote-qrcode.png" width="20%"/></a>
								<a target="_blank" href="https://goo.gl/HjJDIv"><img alt="Vote here too for SSE support in Edge" src="img/edge-vote-qrcode2.png" width="20%"/></a>
								<img alt="Tweet to vote for SSE support in Edge" src="img/edge-vote-twitter-qrcode.png" width="20%"/>
							</div>
						</p>
					</section>
					<section>
						<p>Maximum browser connections per server/proxy</p>
						<div class="row">
							<div class="col-md-6">
								<h2>WebSockets</h2>
								<table>
									<thead>
										<tr>
											<th><img alt="Chrome" src="img/chrome-icon.png"/></th>
											<th><img alt="Firefox" src="img/firefox-icon.png"/></th>
											<th><img alt="IE" src="img/edge-icon.png"/></th>
											<th><img alt="Safari" src="img/safari-icon.png"/></th>
											<th><img alt="Opera" src="img/opera-icon.png"/></th>
										</tr>
									</thead>
									<tbody>
										<tr>
											<td class="no-bottom-line">3237</td>
											<td class="no-bottom-line">200</td>
											<td class="no-bottom-line">128</td>
											<td class="no-bottom-line">2970</td>
											<td class="no-bottom-line">900</td>
										</tr>
									</tbody>
								</table>
								<p class="fragment">beware of DOS!</p>
							</div>
							<div class="col-md-6">
								<h2>Server-Sent Events</h2>
								<table class="fragment">
									<thead>
										<tr>
											<th></th>
											<th><img alt="Chrome" src="img/chrome-icon.png"/></th>
											<th><img alt="Firefox" src="img/firefox-icon.png"/></th>
											<th><img alt="IE" src="img/edge-icon.png"/></th>
											<th><img alt="Safari" src="img/safari-icon.png"/></th>
											<th><img alt="Opera" src="img/opera-icon.png"/></th>
										</tr>
									</thead>
									<tbody>
										<tr>
											<td class="no-bottom-line">HTTP<br>SSE</td>
											<td class="no-bottom-line">6</td>
											<td class="no-bottom-line">6</td>
											<td class="no-bottom-line">8</td>
											<td class="no-bottom-line">6</td>
											<td class="no-bottom-line">6</td>
										</tr>
									</tbody>
								</table>
								<img alt="a solution is coming: multiplexing HTTP connections with HTTP/2" src="img/http2-everywhere.jpg" width="70%" class="fragment"/>
							</div>
						</div>
					</section>
					<section>
						<div class="row">
							<div class="col-md-6">
								<h2>WebSockets</h2>
							</div>
							<div class="col-md-6">
								<h2>Server-Sent Events</h2>
								<p>
									<img alt="custom headers not supported" src="img/headers.jpg" class="fragment"/>
								</p>
								<p class="fragment">=> use query params</p>
							</div>
						</div>
					</section>
					<section>
						<div class="row">
							<div class="col-md-6">
								<h2>WebSockets</h2>
	<pre><code>var websocket =
  new WebSocket('ws://mywebsocketserver/echo');
websocket.onopen = function () {
	...
};

websocket.onmessage = function (e) {
	...
};

websocket.onerror = function (error) {
	...
};
</code></pre>
						</div>
						<div class="col-md-6">
							<h2>Server-Sent Events</h2>
<pre class="fragment"><code>var eventSource =
  new EventSource('http://mysseserver/echo');
eventSource.onopen = function () {
	...
};

eventSource.onmessage = function (e) {
	...
};

eventSource.onerror = function (error) {
	...
};
source.addEventListener('foo', function(e) {
  ...
}, false);
	</code></pre>
							</div>
						</div>
					</section>
				</section>
				<section>
					<h3>Some Java servers</h3>
					<img alt="Undertow, Tomcat, Jetty, Ratpack, Netty, Spring supports WebSockets and SSE implementations" src="img/servers-cloud.png"/>
					<h3>Client libraries supports</h3>
					<img alt="Node.js, Java, Ruby, Python, Haskell, Go, Rust, C, ObjectiveC, ... have WebSockets and SSE implementations thanks to third-party libraries" src="img/clients-cloud.png"/>
				</section>
				<section>
					<h1>"Perfs"</h1>
					<p>Use case: Préchargement de 500 Tweets sur une page web (nginx configuré en tant que proxy)</p>
					<table>
						<thead>
							<tr>
								<th>&nbsp;</th>
								<th><img alt="Safari" src="img/safari-icon.png"/></th>
								<th><img alt="Chrome" src="img/chrome-icon.png"/></th>
								<th><img alt="Firefox" src="img/firefox-icon.png"/></th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>WebSockets</td>
								<td>16s</td>
								<td>8s</td>
								<td>8s</td>
							</tr>
							<tr>
								<td>SSE</td>
								<td><span class="success">7s</span></td>
								<td><span class="success">5s</span></td>
								<td><span class="success">6s</span></td>
							</tr>
							<tr>
								<td>diff</td>
								<td>x2.2</td>
								<td>x1.6</td>
								<td>x13</td>
							</tr>
						</tbody>
					</table>
					<p>Source http://matthiasnehlsen.com/blog/2013/05/01/server-sent-events-vs-websockets/</p>
				</section>
				<section>
					<h1>Use cases</h1>
					<div class="row">
						<div class="col-md-6">
							<h2>WebSockets</h2>
							<p>
								<ul>
									<li>Chat, chat, chat (*)</li>
									<li class="fragment" data-fragment-index="2">Share living editing</li>
									<li class="fragment" data-fragment-index="3">GPS GoogleMap-like</li>
									<li class="fragment" data-fragment-index="4">Games</li>
								</ul>
								<img alt="Chat application" src="img/cat-computer.gif" height="200px" width="200px" class="fragment" data-fragment-index="1"/>
							</p>
							<p class="fragment" data-fragment-index="5" style="font-size: small;">(*) WebRTC might be even more suitable</p>
						</div>
						<div class="col-md-6">
							<h2>Server-Sent Events</h2>
							<ul>
								<li class="fragment" data-fragment-index="6">Fintech / Trading</li>
								<li class="fragment" data-fragment-index="7">Betting</li>
								<li class="fragment" data-fragment-index="8">Games</li>
								<li class="fragment" data-fragment-index="9">Realtime timetables</li>
								<li class="fragment" data-fragment-index="10">Animated data apps (charts, monitoring, etc.)</li>
								<li class="fragment" data-fragment-index="11">etc.</li>
							</ul>
						</div>
					</div>
				</section>
				<section>
					<h1>Conclusion</h1>
					<p>
						Use the right tools for the right things.
						<div>
							<img alt="Use the right tools for the right things!" src="img/tools-498202_640.jpg"/>
						</div>
					</p>
				</section>
				<section>
					<h1>Thank you!</h1>
				</section>
				<section>
					<h1>References</h1>
					<p>JS Polyfills:
						<ul>
							<li><a target="_blank" href="https://github.com/streamdataio/EventSource">Streamdata.io fork from AMVTek</a></li>
							<li><a target="_blank" href="https://github.com/amvtek/EventSource">AMVTek</a></li>
							<li><a target="_blank" href="https://github.com/Yaffle/EventSource/">Yaffle</a></li>
							<li><a target="_blank" href="https://github.com/remy/polyfills/blob/master/EventSource.js">Remi</a></li>
						</ul>
					</p>
				</section>
				<section>
					<h1>References</h1>
					<p>
						WebSockets / SSE:
						<ul>
							<li><a target="_blank" href="http://streamdata.io/blog/server-sent-events/">What is Server-Sent Events?</a></li>
							<li><a target="_blank" href="http://streamdata.io/blog/push-sse-vs-websockets/">WebSockets vs SSE</a></li>
							<li><a target="_blank" href="https://www.google.fr/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&cad=rja&uact=8&ved=0CCAQtwIwAGoVChMI95Hmhoe6yAIVwdMaCh3NdQ8J&url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DvhJz3HftuZU&usg=AFQjCNHl-lUmlneOvf1dPNwBimq3_wSyIA&bvm=bv.104819420,d.d2s">Getting started with WebSockets and SSE</a></li>
							<li><a target="_blank" href="https://segment.com/blog/2014-04-03-server-sent-events-the-simplest-realtime-browser-spec/">Server-Sent Events: The simplest realtime browser spec</a></li>
						</ul>
					</p>
				</section>
				<section>
					<h1>References</h1>
					<p>Connection limits:
						<ul>
							<li><a target="_blank" href="http://media.blackhat.com/bh-us-12/Briefings/Shekyan/BH_US_12_Shekyan_Toukharian_Hacking_Websocket_Slides.pdf">Hacking WebSockets</a></li>
							<li><a target="_blank" href="http://stackoverflow.com/questions/985431/max-parallel-http-connections-in-a-browser">StackOverflow</a></li>
						</ul>
					</p>
				</section>
			</div>
		</div>
		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>
		<script src="js/jquery.min.js"></script>

		<script>
			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
				width: '100%',
				height: '100%',

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

			var html_barra = '<div class="bottom-logo"><img alt="logo" src="img/logo-streamdataio-48.png"></div>';
			Reveal.addEventListener( 'slidechanged', function( event ) {
				// if ( window.location.search.match( /print-pdf/gi ) ) {
				// 		// $('section').append(html_barra);
				// }
				// else {
					var hasNotLogo = !$('div.reveal.bottom-logo') || $('div.reveal.bottom-logo').length == 0;
					if (hasNotLogo && !Reveal.isFirstSlide()) {
						$('div.reveal').append(html_barra);
					}
				// }
			} );

		</script>

	</body>
</html>
